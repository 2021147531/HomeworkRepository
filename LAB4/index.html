<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="UTF-8">
        <title>ì˜í™” ì •ë³´ ë©”ì¸ í˜ì´ì§€</title>
        <link rel="stylesheet" type="text/css" href="main.css">
    </head>
    <body>
        <div class="container">

            <!-- ì œëª© -->
            <div class="title-holder">
                <h1 class="title">ì¸í”„ë° ì˜í™” ì •ë³´ ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤.</h1>
            </div>

            <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
            <div class="nav">
                <a href="index.html" class="current-page">ë©”ì¸í˜ì´ì§€</a>
                <a href="login.html">ë¡œê·¸ì¸</a>
                <a href="signup.html">íšŒì›ê°€ì…</a>
            </div>

            <!-- ê²€ìƒ‰ì°½ -->
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.">
                <button id="filter-btn">Filter results</button>
            </div>

            <!-- ì˜í™” ì„¹ì…˜ -->
            <h2 class="section-title">Movies</h2>

            <div class="movie-section">
                <!-- ì •ë ¬ ê¸°ì¤€ -->
                <div class="filter">
                    <p>ì •ë ¬ ê¸°ì¤€</p>
                    <label><input type="radio" name="sort" value="ratingDesc"> í‰ì  ë‚´ë¦¼ì°¨ìˆœ</label><br>
                    <label><input type="radio" name="sort" value="ratingAsc"> í‰ì  ì˜¤ë¦„ì°¨ìˆœ</label><br>
                    <label><input type="radio" name="sort" value="dateDesc"> ê°œë´‰ ë‚´ë¦¼ì°¨ìˆœ</label><br>
                    <label><input type="radio" name="sort" value="dateAsc"> ê°œë´‰ ì˜¤ë¦„ì°¨ìˆœ</label>
                </div>

                <!-- ì˜í™” ì¹´ë“œ -->
                <div id="movie-list" class="movies"></div>

            </div>
        </div>

        <script>
            let allMovies = [];
            let filteredMovies = [];
            let currentIndex = 0;
            const batchSize = 6;
            let hasMore = true;

            // JSON ë°ì´í„° ë¡œë“œ
            fetch('product.json')
            // JSON ë¡œë”© í™•ì¸
            .then(response => {
                if (!response.ok) throw new Error('JSON ë¡œë”© ì‹¤íŒ¨');
                return response.json();
                })
            //
            .then(data => {
                allMovies = data;
                filteredMovies = [...allMovies];    // ìš°ì„  filteredMoviesì— allMoviesë¥¼ ê·¸ëŒ€ë¡œ ë³µì‚¬
                loadNextMovies();   // ì‹¤ì œ movie cardë¥¼ ë§Œë“¤ì–´ ë¡œë”©
                window.addEventListener('scroll', handleScroll);    // infinite scrollì„ ìœ„í•œ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                })
            // ì—ëŸ¬ ì¼€ì´ìŠ¤
            .catch(error => console.error('ì—ëŸ¬:', error));

            // í‚¤ì›Œë“œ ê²€ìƒ‰
            document.getElementById('filter-btn').addEventListener('click', () => {
                // filter-btnì˜ í´ë¦­ì„ íŠ¸ë¦¬ê±°ë¡œ ì‹¤í–‰
                const keyword = document.getElementById('search-input').value.trim().toLowerCase();
                // keywordë¥¼ ë°›ì•„ì™€ì„œ ê³µë°± ì œê±° ë° ëŒ€ë¬¸ì ì œê±°
                currentIndex = 0;
                hasMore = true;

                // ê²€ìƒ‰ ë‹¨ì–´ê°€ ì—†ì„ ê²½ìš°ì˜ ì¼€ì´ìŠ¤
                if (keyword === '') {
                    filteredMovies = [...allMovies];    // í•„í„° ëœ ê²ƒê³¼ ì „ì²´ê°€ ë™ì¼
                }
                // ê²€ìƒ‰ ë‹¨ì–´ê°€ ìˆì„ ê²½ìš°ì˜ ì¼€ì´ìŠ¤
                else {
                    // movieì˜ titleì— í•´ë‹¹ keywordê°€ ìˆëŠ”ì§€ í•„í„°ë§í•˜ì—¬ filteredMoviesë¡œ ì €ì¥
                    filteredMovies = allMovies.filter(movie =>
                        movie.title.toLowerCase().includes(keyword)
                    );
                }

                document.getElementById('movie-list').innerHTML = '';
                loadNextMovies();   // movie card ë¡œë”©
            });

            // ì •ë ¬ ê¸°ëŠ¥
            document.querySelectorAll('input[name="sort"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    // ì–´ë–¤ ë²„íŠ¼ì´ ëˆŒë ¸ëŠ”ì§€ í™•ì¸í•˜ì—¬ ì†ŒíŒ… ì˜µì…˜ í™•ì¸
                    const sortOption = radio.value;

                    // ê° ì†ŒíŒ… ì˜µì…˜ì— ë”°ë¼ì‚¬ ì ì ˆí•œ ê°’ì„ ë¹„êµí•˜ì—¬ì„œ ì •ë ¬
                    filteredMovies.sort((a, b) => {
                        if (sortOption === 'ratingDesc') {
                            return parseFloat(b.rating) - parseFloat(a.rating);
                        }
                        else if (sortOption === 'ratingAsc') {
                            return parseFloat(a.rating) - parseFloat(b.rating);
                        }
                        else if (sortOption === 'dateDesc') {
                            return new Date(b.releaseDate) - new Date(a.releaseDate);
                        }
                        else if (sortOption === 'dateAsc') {
                            return new Date(a.releaseDate) - new Date(b.releaseDate);
                        }

                        return 0;
                    });

                    currentIndex = 0;
                    hasMore = true;
                    document.getElementById('movie-list').innerHTML = '';
                    loadNextMovies();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    // í•„ìš”í•œ ì¹´ë“œë¥¼ ë°›ì•„ì™€ì„œ ë¡œë”©ì„ ì§„í–‰, ì´í›„ ì›¹í˜ì´ì§€ë¥¼ ë§¨ ìœ„ë¡œ ì´ë™
                });
            });

            // ë¬´í•œ ìŠ¤í¬ë¡¤
            function handleScroll() {
                if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
                    loadNextMovies();
                }
            }

            // ì¹´ë“œ ì¶œë ¥
            function loadNextMovies() {
            // ë” ë¡œë”©í•´ì•¼ í•  ê°’ì´ ì—†ìœ¼ë©´ ë
                if (!hasMore)
                    return;

                const container = document.getElementById('movie-list');
                const nextBatch = filteredMovies.slice(currentIndex, currentIndex + batchSize);

                // batchSize ê°œìˆ˜ë§Œí¼ ë‹¤ìŒ ê°’ì„ ë°›ì•„ì˜¤ê¸°
                nextBatch.forEach(movie => {
                    const card = document.createElement('div');
                    card.className = 'movie-card';

                    // ë³´ì—¬ì£¼ëŠ” cardì˜ ë‚´ìš© ì‘ì„±
                    // ê¸°ë³¸ì ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ” title-wrapperì™€ ì¤„ê±°ë¦¬ë¥¼ ë³´ì—¬ì£¼ëŠ” plot-wrapperë¥¼ ë‘˜ ë‹¤ ë°°ì¹˜
                    card.innerHTML = `
                        <div class="title-wrapper">
                            <img src="images/${movie.poster}" alt="${movie.title}">
                            <h3>${movie.title}</h3>
                            <p>â­ í‰ì : ${movie.rating}</p>
                            <p>ğŸ“… ê°œë´‰ì¼: ${movie.releaseDate}</p>
                        </div>

                        <div class="plot-wrapper" style="display: none;">
                            <p style="font-size:14px; text-align:left;">${movie.plot}</p>
                        </div>
                    `;

                    // ì´ë²¤íŠ¸ ì—°ê²°
                    card.addEventListener('mouseenter', () => {
                        // ë§ˆìš°ìŠ¤ê°€ ì˜¬ë¼ì™”ì„ ë•Œ - í˜¸ë²„ë§ ì‹œ ë³´ì—¬ì£¼ëŠ” ê²ƒì„ title-wrapperì—ì„œ plot-wrapperë¡œ ë³€ê²½
                        card.querySelector('.title-wrapper').style.display = 'none';
                        card.querySelector('.plot-wrapper').style.display = 'block';
                    });

                    card.addEventListener('mouseleave', () => {
                        // ë§ˆìš°ìŠ¤ê°€ ë– ë‚  ë•Œ ë‹¤ì‹œ ì›ë˜ëŒ€ë¡œ title-wrapperë¥¼ ë³´ì´ê³  plot-wrapperë¥¼ ë”
                        card.querySelector('.plot-wrapper').style.display = 'none';
                        card.querySelector('.title-wrapper').style.display = 'block';
                    });

                    container.appendChild(card);
                });

                currentIndex += batchSize;
                if (currentIndex >= filteredMovies.length) {
                    hasMore = false;
                }
            }
        </script>
    </body>
</html>
